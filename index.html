<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kameoka Farm | 生命の履歴を味わう</title>
    <!-- 依存ライブラリの読み込み -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@200;400;700&family=Noto+Sans+JP:wght@100;300;400;700&display=swap');
        
        :root { --brand-green: #1A2F23; }

        body { 
            font-family: 'Noto Sans JP', sans-serif; 
            overflow-x: hidden;
            background-color: #FDFCFB;
            color: #1A2F23;
        }

        .font-serif { font-family: 'Noto Serif JP', serif; }
        
        .glass-nav {
            background: rgba(253, 252, 251, 0.8);
            backdrop-filter: blur(20px);
        }

        .reveal-img {
            transition: transform 1.5s cubic-bezier(0.2, 1, 0.3, 1);
        }
        .group:hover .reveal-img {
            transform: scale(1.08);
        }

        .fade-up {
            animation: fadeUp 1.2s ease forwards;
        }
        @keyframes fadeUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #1A2F23; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { motion, AnimatePresence } = Motion;

        // 言語設定
        const LANGUAGES = {
            ja: {
                heroTitle: "生命の履歴を、味わう。",
                heroSub: "夜間回復（ゼロクロス）を経て凝縮された、情報の製造業としての果実。",
                dashboardTitle: "圃場の今",
                philosophyTitle: "引き算の美学",
                philosophySub: "余白が、本質を際立たせる。",
                philosophyText: "私たちは単に果物を育てているのではありません。土壌、光、風、そして植物の自己回復力をデータとして記録し、その「生命のプロセス」を価値としてお届けしています。装飾を削ぎ落とし、果実が本来持つ生命力と対話する。それが私たちの哲学です。",
                productsTitle: "Our Collection",
                buyNow: "購入ページへ",
                dataSugar: "糖度",
                aiGreeting: "亀岡農園のAIコンシェルジュです。今日の体調や気分に合わせた果実を処方いたします。"
            },
            en: {
                heroTitle: "Taste the History of Life.",
                heroSub: "Crafted as information, condensed through nocturnal recovery.",
                dashboardTitle: "Live Field Data",
                philosophyTitle: "The Aesthetics of Subtraction",
                philosophySub: "Minimalism reveals the essence.",
                philosophyText: "We don't just grow fruit. We record soil, light, wind, and the plant's self-healing power as data, delivering that 'life process' as value.",
                productsTitle: "Our Collection",
                buyNow: "Order Now",
                dataSugar: "Brix",
                aiGreeting: "I am the AI Concierge of Kameoka Farm."
            }
        };

        // 商品データ
        // 画像は GitHub の img フォルダから読み込むようパスを固定しています。
        const PRODUCTS = [
            { 
                id: 1, name: "温州ミカン", price: 4800, sugar: "13.5", key: "MIKAN", 
                description: "冬の陽光を閉じ込めた、王道の甘みと酸味。",
                image: "./img/mikan.jpg" 
            },
            { 
                id: 2, name: "八朔", price: 5200, sugar: "11.0", key: "HASSAKU", 
                description: "清涼感あふれる苦味。大人のための洗練された黄色い柑橘。",
                image: "./img/hassaku.jpg" 
            },
            { 
                id: 3, name: "不知火", price: 6500, sugar: "14.2", key: "SHIRANUI", 
                description: "濃厚なコクと突き抜ける甘み。デコポン特有の山がある最高傑作。",
                image: "./img/shiranui.jpg" 
            }
        ];

        function App() {
            const [lang, setLang] = useState('ja');
            const [isAiOpen, setIsAiOpen] = useState(false);
            const [scrolled, setScrolled] = useState(false);
            const t = LANGUAGES[lang];

            useEffect(() => {
                const handleScroll = () => setScrolled(window.scrollY > 50);
                window.addEventListener('scroll', handleScroll);
                lucide.createIcons();
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            useEffect(() => { lucide.createIcons(); }, [isAiOpen, lang]);

            const handleCheckout = (product) => {
                const urls = JSON.parse(localStorage.getItem('stripe_urls') || "{}");
                const url = urls[product.key];
                if (!url || !url.startsWith('http')) {
                    alert("支払いリンクが設定されていません。右下のアイコンから設定してください。");
                    setIsAiOpen(true);
                    return;
                }
                window.location.href = url;
            };

            return (
                <div className="min-h-screen">
                    {/* ナビゲーション */}
                    <nav className={`fixed top-0 w-full z-50 transition-all duration-700 ${scrolled ? 'glass-nav py-4 shadow-sm' : 'bg-transparent py-10'}`}>
                        <div className="container mx-auto px-6 lg:px-10 flex justify-between items-center text-[#1A2F23]">
                            <div className="text-xl font-light tracking-[0.4em] uppercase">
                                Kameoka <span className="font-bold">Farm</span>
                            </div>
                            <div className="flex items-center gap-6 lg:gap-10">
                                <button onClick={() => setLang(lang === 'ja' ? 'en' : 'ja')} className="text-[10px] tracking-[0.2em] uppercase font-bold hover:opacity-50 transition-opacity">
                                    {lang === 'ja' ? 'English' : '日本語'}
                                </button>
                                <i data-lucide="shopping-bag" className="w-5 h-5 cursor-pointer"></i>
                            </div>
                        </div>
                    </nav>

                    {/* ヒーローセクション */}
                    <section className="relative h-screen flex items-center justify-center overflow-hidden bg-[#E5E2DE]">
                        <img 
                            src="./img/hero.jpg" 
                            className="absolute inset-0 w-full h-full object-cover"
                            alt="Farm background"
                            onError={(e) => e.target.style.display = 'none'}
                        />
                        <div className="absolute inset-0 bg-black/30 z-0"></div>
                        <div className="relative z-10 text-center text-white px-6 fade-up">
                            <h1 className="font-serif text-4xl md:text-8xl font-light mb-8 tracking-wider leading-tight">
                                {t.heroTitle}
                            </h1>
                            <p className="text-xs md:text-sm tracking-[0.4em] uppercase opacity-90 mb-12 max-w-2xl mx-auto leading-loose">
                                {t.heroSub}
                            </p>
                            <button 
                                onClick={() => document.getElementById('products').scrollIntoView({behavior:'smooth'})}
                                className="px-12 py-4 border border-white/40 backdrop-blur-md hover:bg-white hover:text-[#1A2F23] transition-all duration-500 text-[10px] tracking-[0.4em] uppercase font-bold"
                            >
                                Explore Collection
                            </button>
                        </div>
                    </section>

                    {/* データ表示 */}
                    <section className="py-20 bg-[#1A2F23] text-white">
                        <div className="container mx-auto px-6 lg:px-10">
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-12 text-center opacity-70">
                                <DataPoint label="Field Temp" value="18.5°C" />
                                <DataPoint label="Humidity" value="62%" />
                                <DataPoint label="Wind" value="1.2m/s" />
                                <DataPoint label="Brix Est." value="13.2°" />
                            </div>
                        </div>
                    </section>

                    {/* 哲学セクション */}
                    <section className="py-32 bg-white overflow-hidden text-left">
                        <div className="container mx-auto px-6 lg:px-10 grid md:grid-cols-2 gap-24 items-center">
                            <motion.div initial={{ opacity: 0, x: -30 }} whileInView={{ opacity: 1, x: 0 }} viewport={{ once: true }}>
                                <img 
                                    src="./img/philosophy.jpg" 
                                    className="w-full aspect-square object-cover shadow-2xl grayscale hover:grayscale-0 transition-all duration-1000"
                                    alt="Detail of citrus"
                                />
                            </motion.div>
                            <div className="space-y-8">
                                <h2 className="text-[10px] tracking-[0.5em] uppercase font-bold text-gray-400">{t.philosophyTitle}</h2>
                                <h3 className="font-serif text-4xl md:text-5xl font-light leading-tight">{t.philosophySub}</h3>
                                <p className="text-gray-500 font-light leading-relaxed text-lg">
                                    {t.philosophyText}
                                </p>
                            </div>
                        </div>
                    </section>

                    {/* 商品一覧 */}
                    <section id="products" className="py-32 bg-[#F8F9FA]">
                        <div className="container mx-auto px-6 lg:px-10 text-center">
                            <h2 className="font-serif text-4xl font-light mb-24 tracking-[0.3em] uppercase">{t.productsTitle}</h2>
                            <div className="grid md:grid-cols-3 gap-16 lg:gap-24 text-left">
                                {PRODUCTS.map(p => (
                                    <div key={p.id} className="group">
                                        <div className="aspect-[4/5] overflow-hidden mb-8 bg-gray-200 relative shadow-lg">
                                            <img src={p.image} className="w-full h-full object-cover reveal-img" alt={p.name} />
                                            <div className="absolute top-4 left-4 bg-white/90 backdrop-blur px-2 py-1 text-[8px] font-bold tracking-widest uppercase font-sans">Batch #2024-{p.id}</div>
                                        </div>
                                        <div className="space-y-4 px-2">
                                            <div className="flex justify-between items-end">
                                                <h3 className="font-serif text-2xl font-light">{p.name}</h3>
                                                <span className="text-[10px] tracking-widest text-gray-400 uppercase font-bold">{t.dataSugar}: {p.sugar}°</span>
                                            </div>
                                            <p className="text-xs text-gray-400 font-light leading-relaxed h-12">{p.description}</p>
                                            <div className="pt-6 border-t border-gray-100 flex justify-between items-center">
                                                <span className="text-sm font-bold tracking-widest">¥{p.price.toLocaleString()}</span>
                                                <button 
                                                    onClick={() => handleCheckout(p)}
                                                    className="text-[10px] font-bold tracking-[0.2em] uppercase hover:text-orange-600 transition-colors flex items-center gap-2"
                                                >
                                                    {t.buyNow} <i data-lucide="arrow-right" className="w-3 h-3"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </section>

                    {/* フッター */}
                    <footer className="py-24 bg-white border-t border-gray-100 text-center">
                        <div className="text-lg font-light tracking-[0.6em] uppercase mb-4">Kameoka Farm</div>
                        <p className="text-[10px] text-gray-300 tracking-[0.3em] uppercase mb-8">&copy; 2024 Information Manufacturing.</p>
                        <div className="flex justify-center gap-6 opacity-30">
                            <i data-lucide="instagram" className="w-4 h-4 cursor-pointer"></i>
                            <i data-lucide="twitter" className="w-4 h-4 cursor-pointer"></i>
                            <i data-lucide="mail" className="w-4 h-4 cursor-pointer"></i>
                        </div>
                    </footer>

                    {/* AI・設定ボタン */}
                    <button 
                        onClick={() => setIsAiOpen(true)}
                        className="fixed bottom-10 right-10 w-16 h-16 bg-[#1A2F23] text-white rounded-full shadow-2xl flex items-center justify-center hover:scale-110 active:scale-95 transition-all z-50 shadow-black/20"
                    >
                        <i data-lucide="message-square" className="w-6 h-6"></i>
                    </button>

                    <AnimatePresence>
                        {isAiOpen && (
                            <UnifiedModal onClose={() => setIsAiOpen(false)} t={t} lang={lang} />
                        )}
                    </AnimatePresence>
                </div>
            );
        }

        function DataPoint({ label, value }) {
            return (
                <div className="space-y-2">
                    <p className="text-[8px] uppercase tracking-widest opacity-40 font-bold">{label}</p>
                    <p className="text-2xl font-light tracking-tight">{value}</p>
                </div>
            );
        }

        function UnifiedModal({ onClose, t, lang }) {
            const [view, setView] = useState(localStorage.getItem('gemini_api_key') ? 'chat' : 'settings');
            const [apiKey, setApiKey] = useState(localStorage.getItem('gemini_api_key') || "");
            const [stripeUrls, setStripeUrls] = useState(JSON.parse(localStorage.getItem('stripe_urls') || "{}"));
            const [messages, setMessages] = useState([{ role: 'ai', text: t.aiGreeting }]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const scrollRef = useRef(null);

            useEffect(() => { if (scrollRef.current) scrollRef.current.scrollTop = scrollRef.current.scrollHeight; lucide.createIcons(); }, [messages, view]);

            const handleSave = () => {
                localStorage.setItem('gemini_api_key', apiKey.trim());
                localStorage.setItem('stripe_urls', JSON.stringify(stripeUrls));
                alert("設定を保存しました。リロードします。"); window.location.reload();
            };

            const handleSend = async () => {
                if (!input.trim() || !apiKey || loading) return;
                const userMsg = input; setInput('');
                setMessages(prev => [...prev, { role: 'user', text: userMsg }]);
                setLoading(true);
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey.trim()}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userMsg }] }],
                            systemInstruction: { parts: [{ text: `あなたは高級農園「亀岡農園」の知的なコンシェルジュです。果実の魅力を上品に${lang === 'ja' ? '日本語' : '英語'}で伝えてください。` }] }
                        })
                    });
                    const data = await response.json();
                    setMessages(prev => [...prev, { role: 'ai', text: data.candidates[0].content.parts[0].text }]);
                } catch (err) { setMessages(prev => [...prev, { role: 'ai', text: "接続エラー。設定を確認してください。" }]); }
                finally { setLoading(false); }
            };

            return (
                <motion.div 
                    initial={{ opacity: 0, y: 100 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 100 }} 
                    className="fixed bottom-32 right-10 w-[92vw] md:w-[420px] h-[600px] bg-white shadow-3xl rounded-3xl z-[60] flex flex-col overflow-hidden border border-gray-100"
                >
                    <div className="bg-[#1A2F23] p-6 text-white flex justify-between items-center text-[10px] tracking-widest uppercase font-bold">
                        <div className="flex gap-8">
                            <button onClick={() => setView('chat')} className={view === 'chat' ? 'border-b border-white pb-1' : 'opacity-40'}>Chat</button>
                            <button onClick={() => setView('settings')} className={view === 'settings' ? 'border-b border-white pb-1' : 'opacity-40'}>Setup</button>
                        </div>
                        <button onClick={onClose}><i data-lucide="x" className="w-5 h-5"></i></button>
                    </div>

                    {view === 'settings' ? (
                        <div className="flex-1 p-8 overflow-y-auto space-y-6 text-left">
                            <h3 className="text-xs font-bold tracking-widest uppercase mb-4 border-b pb-2">Environment Setup</h3>
                            <div className="space-y-4">
                                {PRODUCTS.map(p => (
                                    <div key={p.id}>
                                        <span className="text-[9px] text-gray-400 uppercase font-bold">{p.name} Stripe URL</span>
                                        <input type="text" value={stripeUrls[p.key] || ''} onChange={e => setStripeUrls({...stripeUrls, [p.key]: e.target.value})} placeholder="https://buy.stripe.com/..." className="w-full p-2 text-xs border rounded-xl bg-gray-50 mt-1 outline-none" />
                                    </div>
                                ))}
                            </div>
                            <div className="pt-6 border-t">
                                <span className="text-[9px] text-gray-400 uppercase font-bold">Gemini API Key</span>
                                <input type="password" value={apiKey} onChange={e => setApiKey(e.target.value)} placeholder="AIza..." className="w-full p-2 text-xs border rounded-xl bg-gray-50 mt-1 outline-none" />
                            </div>
                            <button onClick={handleSave} className="w-full py-4 bg-[#1A2F23] text-white text-[10px] font-bold uppercase tracking-[0.3em] rounded-xl shadow-lg mt-4">Save Configuration</button>
                        </div>
                    ) : (
                        <>
                            <div ref={scrollRef} className="flex-1 p-8 overflow-y-auto space-y-6 bg-[#FDFCFB] text-left">
                                {messages.map((m, i) => (
                                    <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                        <div className={`max-w-[85%] p-5 text-sm ${m.role === 'user' ? 'bg-[#1A2F23] text-white rounded-2xl rounded-tr-none' : 'bg-white border border-gray-100 text-gray-800 rounded-2xl rounded-tl-none font-light shadow-sm'}`}>{m.text}</div>
                                    </div>
                                ))}
                            </div>
                            <div className="p-6 border-t flex gap-4 bg-white">
                                <input value={input} onChange={e => setInput(e.target.value)} onKeyDown={e => e.key === 'Enter' && handleSend()} placeholder="Ask anything..." className="flex-1 text-sm p-4 bg-gray-50 rounded-2xl outline-none" />
                                <button onClick={handleSend} className="p-4 bg-[#1A2F23] text-white rounded-2xl"><i data-lucide="send" className="w-4 h-4"></i></button>
                            </div>
                        </>
                    )}
                </motion.div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
