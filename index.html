<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kameoka Farm | 六次産業化の未来</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM CDN -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Framer Motion (Note: Global variable is 'Motion') -->
    <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@100;300;400;700&display=swap');
        body { font-family: 'Noto Sans JP', sans-serif; overflow-x: hidden; }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(10px); }
        /* Fix for Lucide icons rendering */
        .lucide { stroke-width: 1.5px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        // The global variable for Framer Motion via CDN is 'Motion'
        const { motion, AnimatePresence } = Motion;

        // --- Config ---
        const apiKey = ""; 

        const LANGUAGES = {
            ja: {
                heroTitle: "生命の履歴を、味わう。",
                heroSub: "夜間回復（ゼロクロス）を経て凝縮された、情報の製造業としての果実。",
                dashboardTitle: "圃場の今",
                philosophyTitle: "引き算の美学",
                philosophyText: "私たちは単に果物を育てているのではありません。土壌、光、風、そして植物の自己回復力をデータとして記録し、その「生命のプロセス」を価値としてお届けしています。",
                productsTitle: "果実のラインナップ",
                aiTitle: "AI果実処方",
                aiPlaceholder: "今の気分や体調を教えてください",
                addToCart: "カートに追加",
                checkout: "購入手続きへ",
                dataSugar: "糖度",
                dataAcid: "酸度",
                dataSize: "サイズ",
                aiGreeting: "亀岡農園のAIコンシェルジュです。今日の体調や気分に合わせて、あなたに最適な果実をご提案します。"
            },
            en: {
                heroTitle: "Taste the History of Life.",
                heroSub: "Fruits crafted as 'Information Manufacturing', condensed through nocturnal recovery.",
                dashboardTitle: "Real-time Field Data",
                philosophyTitle: "Aesthetics of Subtraction",
                philosophyText: "We don't just grow fruit. We record soil, light, wind, and the plant's self-healing power as data, delivering that 'life process' as value.",
                productsTitle: "Product Collection",
                aiTitle: "AI Fruit Prescription",
                aiPlaceholder: "How are you feeling today?",
                addToCart: "Add to Cart",
                checkout: "Checkout",
                dataSugar: "Sugar",
                dataAcid: "Acid",
                dataSize: "Size",
                aiGreeting: "Hello, I am the Kameoka Farm AI Concierge. I will prescribe the perfect fruit based on your mood and condition."
            }
        };

        const PRODUCTS = [
            { id: 1, name: "温州ミカン", enName: "Satsuma Mandarin", price: 3500, sugar: "13.5", acid: "0.8", size: "M/L", image: "https://images.unsplash.com/photo-1557800636-894a64c1696f?auto=format&fit=crop&q=80&w=800" },
            { id: 2, name: "八朔", enName: "Hassaku", price: 4200, sugar: "11.0", acid: "1.5", size: "L", image: "https://images.unsplash.com/photo-1591133111033-fb90192091c0?auto=format&fit=crop&q=80&w=800" },
            { id: 3, name: "不知火", enName: "Shiranui", price: 5800, sugar: "14.2", acid: "1.1", size: "2L", image: "https://images.unsplash.com/photo-1611080626919-7cf5a9dbab5b?auto=format&fit=crop&q=80&w=800" }
        ];

        function App() {
            const [lang, setLang] = useState('ja');
            const [isAiOpen, setIsAiOpen] = useState(false);
            const [scrolled, setScrolled] = useState(false);
            const [cartCount, setCartCount] = useState(0);
            const t = LANGUAGES[lang];

            useEffect(() => {
                const handleScroll = () => setScrolled(window.scrollY > 50);
                window.addEventListener('scroll', handleScroll);
                // Initial icons
                lucide.createIcons();
                return () => window.removeEventListener('scroll', handleScroll);
            }, []);

            // Re-run lucide on certain state changes if needed
            useEffect(() => {
                lucide.createIcons();
            }, [isAiOpen, lang]);

            return (
                <div className="min-h-screen bg-[#FDFCFB] text-[#1A2F23]">
                    {/* Navigation */}
                    <nav className={`fixed top-0 w-full z-50 transition-all duration-500 ${scrolled ? 'bg-white/80 glass py-4 shadow-sm' : 'bg-transparent py-8'}`}>
                        <div className="container mx-auto px-6 flex justify-between items-center">
                            <div className="text-xl font-light tracking-[0.2em] uppercase">Kameoka <span className="font-bold">Farm</span></div>
                            <div className="flex items-center gap-6">
                                <button onClick={() => setLang(lang === 'ja' ? 'en' : 'ja')} className="text-xs tracking-widest hover:opacity-50">
                                    {lang === 'ja' ? 'ENGLISH' : '日本語'}
                                </button>
                                <div className="relative">
                                    <i data-lucide="shopping-cart" className="w-5 h-5 cursor-pointer"></i>
                                    {cartCount > 0 && (
                                        <span className="absolute -top-2 -right-2 bg-orange-500 text-white text-[10px] w-4 h-4 rounded-full flex items-center justify-center font-bold">{cartCount}</span>
                                    )}
                                </div>
                            </div>
                        </div>
                    </nav>

                    {/* Hero */}
                    <section className="relative h-screen flex items-center justify-center text-center overflow-hidden">
                        <img src="https://images.unsplash.com/photo-1523348837708-15d4a09cfac2?auto=format&fit=crop&q=80&w=2000" className="absolute inset-0 w-full h-full object-cover z-0" alt="Background" />
                        <div className="absolute inset-0 bg-black/30 z-10"></div>
                        <div className="relative z-20 text-white px-6">
                            <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.8 }} className="text-4xl md:text-7xl font-light mb-6 tracking-tight">
                                {t.heroTitle}
                            </motion.h1>
                            <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5, duration: 0.8 }} className="text-lg md:text-xl font-light opacity-80 mb-10 max-w-2xl mx-auto">{t.heroSub}</motion.p>
                            <motion.button initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 1 }} className="px-8 py-3 border border-white/50 hover:bg-white hover:text-black transition-all tracking-widest text-xs uppercase">Explore</motion.button>
                        </div>
                    </section>

                    {/* Dashboard */}
                    <section className="py-20 bg-[#1A2F23] text-white">
                        <div className="container mx-auto px-6">
                            <h2 className="text-xs tracking-[0.3em] uppercase opacity-50 mb-12 text-center">{t.dashboardTitle}</h2>
                            <div className="grid grid-cols-2 md:grid-cols-4 gap-8">
                                <DashboardCard label="Temp" value="24.5°C" />
                                <DashboardCard label="Humidity" value="62%" />
                                <DashboardCard label="Wind" value="2.4m/s" />
                                <DashboardCard label="Sugar Est." value="13.2°" />
                            </div>
                        </div>
                    </section>

                    {/* Philosophy */}
                    <section className="py-24 bg-white overflow-hidden">
                        <div className="container mx-auto px-6 grid md:grid-cols-2 gap-16 items-center">
                            <motion.div initial={{ opacity: 0, x: -50 }} whileInView={{ opacity: 1, x: 0 }} viewport={{ once: true }}>
                                <img src="https://images.unsplash.com/photo-1605000797499-95a51c5269ae?auto=format&fit=crop&q=80&w=1200" className="w-full aspect-[4/3] object-cover grayscale" />
                            </motion.div>
                            <motion.div initial={{ opacity: 0, x: 50 }} whileInView={{ opacity: 1, x: 0 }} viewport={{ once: true }}>
                                <h2 className="text-3xl font-light mb-8 tracking-tight">{t.philosophyTitle}</h2>
                                <p className="text-gray-500 font-light leading-relaxed text-lg mb-8">{t.philosophyText}</p>
                            </motion.div>
                        </div>
                    </section>

                    {/* Products */}
                    <section className="py-32 bg-[#F8F9FA]">
                        <div className="container mx-auto px-6">
                            <h2 className="text-2xl font-light mb-16 text-center tracking-widest uppercase">{t.productsTitle}</h2>
                            <div className="grid md:grid-cols-3 gap-12">
                                {PRODUCTS.map(p => (
                                    <motion.div key={p.id} whileHover={{ y: -5 }} className="group cursor-pointer">
                                        <div className="aspect-square overflow-hidden mb-6 bg-gray-100 relative">
                                            <img src={p.image} className="w-full h-full object-cover group-hover:scale-105 transition-transform duration-700" />
                                            <div className="absolute top-4 left-4 bg-white px-2 py-1 text-[8px] font-bold tracking-widest uppercase">Batch #240{p.id}</div>
                                        </div>
                                        <div className="flex justify-between items-end mb-4">
                                            <div>
                                                <h3 className="text-lg font-light">{lang === 'ja' ? p.name : p.enName}</h3>
                                                <p className="text-xs text-gray-400">¥{p.price.toLocaleString()}</p>
                                            </div>
                                            <div className="text-[10px] text-gray-400 text-right uppercase">
                                                {t.dataSugar}: {p.sugar}°
                                            </div>
                                        </div>
                                        <button onClick={() => setCartCount(c => c + 1)} className="w-full py-3 border border-black text-[10px] tracking-widest uppercase font-bold hover:bg-black hover:text-white transition-all">
                                            {t.addToCart}
                                        </button>
                                    </motion.div>
                                ))}
                            </div>
                        </div>
                    </section>

                    {/* AI Chat Button */}
                    <button onClick={() => setIsAiOpen(true)} className="fixed bottom-8 right-8 w-14 h-14 bg-orange-500 text-white rounded-full shadow-xl flex items-center justify-center hover:scale-110 transition-transform z-50">
                        <i data-lucide="message-square"></i>
                    </button>

                    {/* AI Modal */}
                    <AnimatePresence>
                        {isAiOpen && (
                            <AiChatModal onClose={() => setIsAiOpen(false)} t={t} lang={lang} />
                        )}
                    </AnimatePresence>

                    <footer className="py-20 bg-white border-t border-gray-100 text-center text-[10px] tracking-widest text-gray-400 uppercase">
                        &copy; 2024 Kameoka Farm. All Rights Reserved.
                    </footer>
                </div>
            );
        }

        function DashboardCard({ label, value }) {
            return (
                <div className="text-center p-6 border border-white/10 hover:bg-white/5 transition-colors">
                    <p className="text-[10px] opacity-40 uppercase mb-2 tracking-widest">{label}</p>
                    <p className="text-2xl font-light">{value}</p>
                </div>
            );
        }

        function AiChatModal({ onClose, t, lang }) {
            const [messages, setMessages] = useState([
                { role: 'ai', text: t.aiGreeting }
            ]);
            const [input, setInput] = useState('');
            const [loading, setLoading] = useState(false);
            const scrollRef = useRef(null);

            useEffect(() => {
                if (scrollRef.current) scrollRef.current.scrollTop = scrollRef.current.scrollHeight;
                lucide.createIcons();
            }, [messages]);

            const callGemini = async (prompt) => {
                const systemPrompt = `あなたは高級農園「亀岡農園」のコンシェルジュです。
                顧客の悩み（体調や気分）に合わせて、以下の3つから最適な果実を選び提案してください。
                - 温州ミカン: 元気が欲しい、風邪予防、手軽な補給
                - 八朔: 集中したい、リフレッシュ、大人の苦味
                - 不知火: 贅沢したい、疲労回復、最高級の甘さ
                トーンは洗練された敬語で、言語は ${lang === 'ja' ? '日本語' : 'English'} で答えてください。`;

                let delay = 1000;
                for (let i = 0; i < 5; i++) {
                    try {
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                contents: [{ parts: [{ text: prompt }] }],
                                systemInstruction: { parts: [{ text: systemPrompt }] }
                            })
                        });
                        if (!response.ok) throw new Error('API Error');
                        const data = await response.json();
                        return data.candidates?.[0]?.content?.parts?.[0]?.text;
                    } catch (err) {
                        if (i === 4) throw err;
                        await new Promise(r => setTimeout(r, delay));
                        delay *= 2;
                    }
                }
            };

            const handleSend = async () => {
                if (!input.trim() || loading) return;
                const userMsg = input;
                setInput('');
                setMessages(prev => [...prev, { role: 'user', text: userMsg }]);
                setLoading(true);

                try {
                    const aiResponse = await callGemini(userMsg);
                    setMessages(prev => [...prev, { role: 'ai', text: aiResponse }]);
                } catch (err) {
                    setMessages(prev => [...prev, { role: 'ai', text: lang === 'ja' ? "申し訳ありません。現在接続が不安定です。" : "Sorry, connection is unstable right now." }]);
                } finally {
                    setLoading(false);
                }
            };

            return (
                <motion.div 
                    initial={{ opacity: 0, y: 50, scale: 0.9 }} 
                    animate={{ opacity: 1, y: 0, scale: 1 }} 
                    exit={{ opacity: 0, y: 50, scale: 0.9 }} 
                    className="fixed bottom-24 right-8 w-80 md:w-96 h-[500px] bg-white shadow-2xl rounded-2xl z-[60] flex flex-col overflow-hidden border border-gray-100"
                >
                    <div className="bg-[#1A2F23] p-5 text-white flex justify-between items-center shrink-0">
                        <div>
                            <p className="text-[10px] tracking-widest uppercase opacity-60">Concierge</p>
                            <h3 className="text-sm font-bold tracking-widest">AI CARE ADVISOR</h3>
                        </div>
                        <button onClick={onClose} className="hover:rotate-90 transition-transform"><i data-lucide="x" className="w-5 h-5"></i></button>
                    </div>
                    <div ref={scrollRef} className="flex-1 p-5 overflow-y-auto space-y-4 bg-[#FDFCFB]">
                        {messages.map((m, i) => (
                            <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                <div className={`max-w-[85%] p-3 text-xs leading-relaxed ${m.role === 'user' ? 'bg-[#1A2F23] text-white rounded-t-xl rounded-bl-xl' : 'bg-gray-100 text-gray-800 rounded-t-xl rounded-br-xl font-light'}`}>
                                    {m.text}
                                </div>
                            </div>
                        ))}
                        {loading && (
                            <div className="flex justify-start">
                                <div className="bg-gray-100 p-3 rounded-full flex gap-1 animate-pulse">
                                    <div className="w-1.5 h-1.5 bg-gray-300 rounded-full"></div>
                                    <div className="w-1.5 h-1.5 bg-gray-300 rounded-full"></div>
                                    <div className="w-1.5 h-1.5 bg-gray-300 rounded-full"></div>
                                </div>
                            </div>
                        )}
                    </div>
                    <div className="p-4 border-t bg-white">
                        <div className="relative">
                            <input 
                                type="text" 
                                value={input}
                                onChange={(e) => setInput(e.target.value)}
                                onKeyDown={(e) => e.key === 'Enter' && handleSend()}
                                placeholder={t.aiPlaceholder} 
                                className="w-full text-xs pl-4 pr-10 py-3 bg-gray-50 rounded-lg outline-none focus:ring-1 focus:ring-orange-200 transition-all" 
                            />
                            <button onClick={handleSend} disabled={loading} className="absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-[#1A2F23] hover:text-orange-500 disabled:opacity-30 transition-colors">
                                <i data-lucide="send" className="w-4 h-4"></i>
                            </button>
                        </div>
                    </div>
                </motion.div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
